<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOVE ARCHIVE</title>
<link href="https://fonts.googleapis.com/css2?family=Elms+Sans:wght@300;400;700&family=Noto+Sans+KR:wght@100;300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<style>
*,*::before,*::after{box-sizing:border-box}
html,body{
    margin:0;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:'Elms Sans',sans-serif;
}
::-webkit-scrollbar{display:none}

#main-content{
    filter:blur(4px);position:relative;width:100%;height:100vh;z-index:10;cursor:pointer
}
#bubblePhysics{position:absolute;inset:0;pointer-events:none;z-index:12}
.a-dot-pattern{
    position:absolute;inset:0;
    background-image:radial-gradient(circle 2.5px,rgba(217,184,184,.7) 100%,transparent);
    background-size:80px 80px;z-index:11
}
.a-footer-text{
    position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
    font-size:15vw;font-weight:400;line-height:.8;color:#D9B8B8;text-align:center;z-index:13
}

#overlay-page{
    position:fixed;inset:0;z-index:50;display:none;
    background:#000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    opacity:0;transition:opacity .6s ease;
    overflow-y:auto;
}
#overlay-page.visible{display:block;opacity:1}

#menu-container{
    position:sticky;
    top:50%;
    transform:translateY(-50%);
    padding:20px;
    z-index:100;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:30px;
}
.menu-text{
    font-size:22px;font-weight:300;color:rgba(255,255,255,.5);
    cursor:pointer;transition:all .4s ease
}
.menu-text:hover{color:#ffffff;text-shadow:0 0 20px rgba(255,255,255,0.6)}
.menu-title{font-weight:700;color:rgba(255,255,255,.7);margin-bottom:115px}

/* 볼륨 컨트롤 */
.volume-control-container {
    margin-top: 40px;
    text-align: center;
    color: rgba(255,255,255,0.5);
    font-family: 'Elms Sans', sans-serif;
    font-weight: 300;
}
.volume-control-container label {
    display: block;
    margin-bottom: 10px;
    font-size: 14px;
}
#volume-slider {
    width: 150px;
    cursor: pointer;
    accent-color: #ffffff;
}

.music-box{
    opacity:0.7;filter:blur(3px);transition:all 0.7s;
    border:2px solid rgba(255,255,255,0.15);
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    cursor:pointer;z-index:200;position:relative;
}
.music-box.playing{
    opacity:1;filter:blur(6px) brightness(0.92) saturate(0.9);
    border-color:rgba(255,255,255,0.6);
    box-shadow:0 25px 60px rgba(255,255,255,0.25)
}

#menu-gray-box{position:absolute;width:325px;height:375px;left:0;top:50%;transform:translateY(-50%);background:url('https://i.imgur.com/UjRrOJ3.jpeg') center/cover}
#menu-gray-box2{position:absolute;width:375px;height:270px;right:0;bottom:50px;background:url('https://i.imgur.com/W0jsfKY.jpeg') center/cover}

#menu-gray-box3{
    position:absolute;
    width:450px;
    height:230px;
    top: calc(50% + 295px); 
    left: 20px;
    background:url('https://i.imgur.com/u1oTeeA.jpg') center/cover;
    border:2px solid rgba(255,255,255,0.15);
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    opacity:0.7; 
    transition:all 0.7s;
    z-index:200;
}
#menu-gray-box3.playing{
    opacity:1;
    filter:blur(6px) brightness(0.92) saturate(0.9);
    border-color:rgba(255,255,255,0.6);
    box-shadow:0 25px 60px rgba(255,255,255,0.25);
}

#menu-gray-box4{
    position:absolute;
    width:375px;
    height:270px;
    right: 40px; 
    bottom: -415px;
    background:url('https://i.imgur.com/VfFDP9J.jpeg') center/cover;
}
#menu-gray-box4.playing{
    opacity:1;filter:blur(6px) brightness(0.92) saturate(0.9);
    border-color:rgba(255,255,255,0.6);
    box-shadow:0 25px 60px rgba(255,255,255,0.25)
}

#menu-gray-box5{
    position:absolute;
    width:270px;
    height:375px;
    top: calc(50% + 645px); 
    left:120px;
    background: url('https://i.imgur.com/3KVTSgx.jpeg') center/cover;
    border:2px solid rgba(255,255,255,0.15);
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    opacity:0.7;
    transition:all 0.7s;
    z-index:200;
}
#menu-gray-box5.playing{
    opacity:1;
    filter:blur(6px) brightness(0.92) saturate(0.9);
    border-color:rgba(255,255,255,0.6);
    box-shadow:0 25px 60px rgba(255,255,255,0.25)
}

#overlay-page::after{content:"";display:block;height:1000px;}

/* 화면E */
#screen-e{
    position:fixed;inset:0;z-index:999;display:none;background:#000;
    cursor:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 32 32'><path fill='none' stroke='%23fff' stroke-width='3' d='M8 8 L24 24 M24 8 L8 24'/></svg>"), auto;
    overflow:hidden;
}
#screen-e.visible{display:block}

#screen-e .dot-layer{
    position:absolute;inset:0;
    background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.75)'/%3E%3C/svg%3E") 40px 40px;
    clip-path:inset(0 0 100% 0);
    animation:revealTopToBottom 2.2s cubic-bezier(0.22,1,0.36,1) forwards;
}
@keyframes revealTopToBottom{to{clip-path:inset(0 0 0 0)}}

#screen-e.closing .dot-layer{
    animation:closeBottomToTop 1.2s cubic-bezier(0.55, 0, 0.45, 1) forwards;
}
@keyframes closeBottomToTop{
    from{clip-path:inset(0 0 0 0);}
    to{clip-path:inset(100% 0 0 0);}
}

#screen-e .e-content{
    position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
    display:flex;align-items:center;justify-content:center;
    gap: 330px; 
    color:#fff;font-size:16px;line-height:1.8;z-index:2;
    opacity:0;animation:fadeIn 1.4s ease-out 1s forwards;
}
@keyframes fadeIn{to{opacity:1}}
#screen-e .e-text{font-weight:300;font-family:'Elms Sans',sans-serif;text-align:center;min-width:180px;}

#screen-e .desc-text {
    font-family:'Noto Sans KR',sans-serif;
    white-space: nowrap; 
    text-align:center;
}

@media (max-width:768px){#screen-e .e-content{flex-direction:column;gap:90px;}}

/* 화면C */
#screen-c {
    position:fixed; inset:0; z-index:999; display:none;
    background:#000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'><path d='M5 12h14M12 5l7 7-7 7'/></svg>") 24 12, auto;
}
#screen-c .c-content {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    text-align:center; color:#fff;
    font-family:'Noto Sans KR',sans-serif;
    font-size: 18px;    
    font-weight: 300;   
    line-height:1.8;
    white-space: nowrap;
}

/* 화면D */
#screen-d {
    position:fixed; inset:0; z-index:1000; display:none;
    background:#000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    overflow-y: auto; 
    padding: 140px 50px 100px; 
}

/* 화면D 상단 헤더 */
.d-header {
    position: fixed; top: 0; left: 0; width: 100%;
    display: flex; justify-content: space-between; align-items: center;
    padding: 30px 50px;
    z-index: 1001; 
}
.d-header-left, .d-header-right {
    display: flex; gap: 40px; align-items: center;
}
.d-menu-item {
    font-family: 'Elms Sans', sans-serif;
    font-size: 18px; font-weight: 300; color: rgba(255,255,255,0.6);
    cursor: pointer; transition: all 0.3s ease;
}
.d-menu-item:hover {
    color: #ffffff; text-shadow: 0 0 10px rgba(255,255,255,0.4);
}
.d-logo {
    font-weight: 700; font-size: 24px; color: #ffffff;
}

.shop-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); 
    gap: 60px 40px; 
    max-width: 1600px;
    margin: 0 auto;
}

.shop-item {
    cursor: pointer;
    transition: transform 0.4s ease, opacity 0.4s ease;
    opacity: 0;
    animation: itemFadeIn 0.8s forwards;
    position: relative; 
}
.shop-item:hover {
    transform: translateY(-10px);
}

.item-img {
    width: 100%;
    aspect-ratio: 16 / 9;
    background-color: #222;
    background-size: cover;
    background-position: center;
    border-radius: 4px;
    margin-bottom: 20px;
    filter: blur(2px) brightness(0.9);
    transition: all 0.3s;
    box-sizing: border-box; 
}

/* 하트 애니메이션 선택 효과 */
.shop-item::after {
    content: '';
    position: absolute;
    top: 35%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 40px; height: 40px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E") no-repeat center/contain;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none;
    z-index: 10;
    filter: drop-shadow(0 0 10px rgba(255,255,255,0.8));
}

.shop-item.selected::after {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.2);
}

.item-info h3 {
    font-family: 'Elms Sans', sans-serif;
    font-size: 20px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 8px;
}
.item-info p {
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px;
    font-weight: 300;
    color: #888;
    line-height: 1.4;
}

@keyframes itemFadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
    .d-header { padding: 20px; }
    .d-header-left, .d-header-right { gap: 20px; }
    .d-menu-item { font-size: 16px; }
    .d-logo { font-size: 20px; }
    
    .shop-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 30px 15px;
        padding-top: 20px;
    }
    #screen-d { padding: 100px 20px 80px; }
    .shop-item::after { top: 30%; width: 30px; height: 30px; }
}

/* 화면F (Blur Help) */
#screen-f {
    position: fixed; inset: 0; z-index: 1100;
    display: none;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    opacity: 0;
    transition: opacity 0.5s ease;
    cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 32 32'><path fill='none' stroke='%23fff' stroke-width='3' d='M8 8 L24 24 M24 8 L8 24'/></svg>"), auto;
}
#screen-f.visible {
    display: block;
    opacity: 1;
}

#screen-f .f-content {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 30px;
    color: #fff; font-size: 16px; line-height: 1.8;
}
/* 화면F 폰트 두께 400 */
#screen-f .desc-text {
    font-family: 'Noto Sans KR', sans-serif;
    font-weight: 400; 
    white-space: nowrap; text-align: center;
}

/* 화면G: 주문 확인서 */
#screen-g {
    position: fixed; inset: 0; z-index: 1200; display: none;
    background:#000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    overflow-y: auto;
    padding: 80px 50px;
}
.g-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 60px; max-width: 1200px; margin-left: auto; margin-right: auto;
}
.g-title {
    font-family: 'Elms Sans', sans-serif; font-size: 32px; font-weight: 700; color: #fff;
}
.g-close-btn {
    font-size: 24px; color: rgba(255,255,255,0.6); cursor: pointer; transition: color 0.3s;
}
.g-close-btn:hover { color: #fff; }

.order-list {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 40px;
    max-width: 1200px; margin: 0 auto;
}

/* 예외 처리 문구: 흰색(100%) & 얇은 폰트 */
.empty-msg {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    text-align: center;
    color: #ffffff;
    font-family: 'Noto Sans KR', sans-serif;
    font-weight: 300; 
    font-size: 18px;
}

.order-item {
    animation: fadeIn 0.6s ease forwards; opacity: 0;
}
.order-item .item-img {
    filter: none; 
    margin-bottom: 15px;
    width: 100%;
    aspect-ratio: 16/9;
    border-radius: 4px;
    object-fit: cover;
}
.order-item h3 { font-size: 18px; margin-bottom: 5px; }
.order-item p { font-size: 13px; }

/* 주문 요약 */
.order-summary-container {
    max-width: 1200px; margin: 60px auto 0;
    font-family: 'Noto Sans KR', sans-serif; color: #fff;
    padding-bottom: 50px;
}
.summary-line {
    width: 100%; height: 1px; background: rgba(255,255,255,0.3); margin-bottom: 30px;
}
.summary-row {
    display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 16px; font-weight: 300;
}
.summary-row.total {
    font-size: 24px; font-weight: 700; margin-top: 20px; color: #fff;
}
.order-btn {
    width: 100%; padding: 20px; margin-top: 40px;
    background: #fff; color: #000;
    font-family: 'Elms Sans', sans-serif; font-weight: 700; font-size: 20px;
    border: none; cursor: pointer; transition: 0.3s;
}
.order-btn:hover { background: #ddd; letter-spacing: 2px; }

@media (max-width: 768px) {
    .order-list { grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .g-title { font-size: 24px; }
}

/* 화면H: 도트 패턴만 남김 */
#screen-h {
    position: fixed; inset: 0; z-index: 1300; display: none;
    background:#000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    overflow-y: auto; padding: 80px 50px; color: #fff;
}
/* 화면H 안에 HOME 버튼 추가 (중앙 배치) */
#screen-h .h-home-btn {
    position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
    font-family: 'Elms Sans', sans-serif; font-size: 18px; font-weight: 700;
    padding: 12px 40px; border: 1px solid #fff; color: #fff; cursor: pointer; transition: 0.3s;
}
#screen-h .h-home-btn:hover {
    background: #fff; color: #000;
}

.h-container {
    max-width: 1000px; margin: 0 auto;
    border: 1px solid rgba(255,255,255,0.2); padding: 40px;
    animation: fadeIn 0.8s ease forwards;
}

.h-header-info {
    display: flex; justify-content: space-between; margin-bottom: 40px;
    font-family: 'Noto Sans KR', sans-serif; font-weight: 300; font-size: 14px; color: rgba(255,255,255,0.7);
}

.h-visualization-section {
    display: flex; gap: 40px; margin-bottom: 60px;
    border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 40px;
    height: 400px;
}
.h-viz-result {
    flex: 1; aspect-ratio: 4/3; background: #111; border-radius: 4px;
    overflow: hidden; position: relative;
}
.h-viz-desc {
    flex: 1; display: flex; flex-direction: column; justify-content: center;
}
.h-viz-desc h3 {
    font-family: 'Elms Sans', sans-serif; font-size: 24px; font-weight: 700; margin-bottom: 20px;
}
.h-viz-desc p {
    font-family: 'Noto Sans KR', sans-serif; font-size: 16px; font-weight: 300; line-height: 1.8; color: rgba(255,255,255,0.8);
}

.h-items-section h4 {
    font-family: 'Noto Sans KR', sans-serif; font-size: 18px; font-weight: 500; margin-bottom: 25px;
}
.h-items-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
}
/* 빈칸 생성용 */
.h-items-grid:empty { display: none; }

.h-item {
    display: flex; gap: 15px; align-items: center;
}
.h-item-img {
    width: 80px; height: 80px; background-size: cover; background-position: center; border-radius: 4px; flex-shrink: 0;
}
.h-item-info h5 {
    font-family: 'Elms Sans', sans-serif; font-size: 16px; font-weight: 700; margin-bottom: 5px;
}
.h-item-info p {
    font-family: 'Noto Sans KR', sans-serif; font-size: 13px; font-weight: 300; color: rgba(255,255,255,0.6);
}

.h-home-btn-container {
    margin-top: 50px; text-align: center;
}
.h-home-btn {
    padding: 15px 50px; background: #fff; color: #000; font-family: 'Elms Sans', sans-serif; font-weight: 700; font-size: 18px; border: none; cursor: pointer; transition: 0.3s;
}
.h-home-btn:hover { background: #ddd; letter-spacing: 2px; }

@media (max-width: 768px) {
    #screen-h { padding: 40px 20px; }
    .h-container { padding: 20px; }
    .h-visualization-section { flex-direction: column; gap: 30px; }
    .h-viz-result { aspect-ratio: 16/9; }
    .h-items-grid { grid-template-columns: repeat(2, 1fr); }
}

/* 화면 & J 스타일 */
/* 화면J: 타인 기록 상세 (Screen H 레이아웃 재사용) */
#screen-j {
    position: fixed; inset: 0; z-index: 1300; display: none;
    background:#000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    overflow-y: auto; padding: 80px 50px; color: #fff;
}
.j-close-btn {
    font-size: 24px; color: rgba(255,255,255,0.6); cursor: pointer; transition: color 0.3s;
    position: absolute; top: 40px; right: 50px; z-index: 10;
}
.j-close-btn:hover { color: #fff; }

.j-container {
    max-width: 1000px; margin: 0 auto; border: 1px solid rgba(255,255,255,0.2); padding: 40px;
    animation: fadeIn 0.8s ease forwards;
}

/* 진짜 당신이 원하던 레이아웃: 한 줄에 하나씩 가로로 꽉 차게 */
.i-fullwidth-stack {
    padding: 60px 40px;
    max-width: 1400px;
    margin: 0 auto;
}
.i-history-card.fullwidth {
    width: 100%;
    height: 240px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 20px;
    overflow: hidden;
    margin-bottom: 30px;
    display: flex;
    transition: all 0.5s ease;
    cursor: pointer;
    
}
.i-history-card.fullwidth:hover {
    transform: translateY(-10px);
    box-shadow: 0 40px 100px rgba(255,255,255,0.2);
    border-color: rgba(255,255,255,0.5);
}
.i-preview-full {
    width: 55%;
    background-size: cover;
    background-position: center;
    transition: all 0.5s;
    filter: blur(1.5px);
}
.i-history-card.fullwidth:hover .i-preview-full {
    transform: scale(1.08);
}
.i-content {
    width: 45%;
    padding: 50px 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    color: white;
    
}
.i-id { font-size: 14px; opacity: 0.6; margin-bottom: 12px; }
.i-type { font-size: 32px; font-weight: 700; margin-bottom: 16px; }
.i-desc { font-size: 18px; opacity: 0.9; line-height: 1.6; }

/* 로딩 화면 */
#loading-screen {
    position: fixed; inset: 0; z-index: 1250; display: none;
    background: #000;
    flex-direction: column; justify-content: center; align-items: center;
}
.heart-loader {
    width: 60px; height: 60px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E") no-repeat center/contain;
    animation: heartbeat 1.2s infinite ease-in-out;
    filter: drop-shadow(0 0 15px rgba(255,255,255,0.7));
}

@keyframes heartbeat {
    0% { transform: scale(1); } 15% { transform: scale(1.2); } 30% { transform: scale(1); } 45% { transform: scale(1.1); } 60% { transform: scale(1); } 100% { transform: scale(1); }
}

/* 흰색 경고 모달 */
#warning-modal {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    z-index: 1400; display: none;
    background: #fff;
    padding: 50px 60px; text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    border-radius: 2px;
}
#warning-modal .msg {
    font-family: 'Noto Sans KR', sans-serif; color: #000;
    font-size: 18px; margin-bottom: 40px; white-space: nowrap; font-weight: 500;
}
#warning-modal .ok-btn {
    font-family: 'Elms Sans', sans-serif; font-weight: 700; font-size: 16px;
    background: #000; color: #fff;
    padding: 12px 40px; border: none; cursor: pointer; transition: 0.2s;
}
#warning-modal .ok-btn:hover { background: #333; }

/* 8개 선택 모달 */
#eight-modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center;
}
#eight-modal-content {
    background: #fff; padding: 40px 50px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border-radius: 2px; width: 380px;
}

#screen-i {
    position: fixed; inset: 0; z-index: 1100; display: none;
    background: #000 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='1' fill='rgba(248,248,248,.7)'/%3E%3C/svg%3E") 40px 40px;
    overflow-y: auto; padding: 100px 50px; color: #fff;
}
.order-history-list {
    max-width: 1000px; margin: 0 auto;
}

.i-history-grid {
    display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px;
}
.i-history-card {
    border: 1px solid rgba(255,255,255,0.1); padding: 25px;
    transition: all 0.3s; cursor: pointer;
}
.i-history-card:hover { border-color: rgba(255,255,255,0.5); transform: translateY(-5px); }

.i-history-header {
    display: flex; justify-content: space-between; margin-bottom: 15px;
    font-family: 'Noto Sans KR', sans-serif; font-size: 12px;
}
.i-id-data, .i-date-data { color: rgba(255,255,255,0.4); }

.i-items-preview {
    display: flex; gap: 5px; margin-bottom: 20px;
}
.i-preview-img {
    width: 60px; height: 34px; background-color: #333;
    background-size: cover; background-position: center; border-radius: 2px;
}

.i-love-type {
    font-family: 'Elms Sans', sans-serif; font-size: 18px; font-weight: 700; margin-bottom: 8px;
}
.i-summary {
    font-family: 'Noto Sans KR', sans-serif; font-size: 13px; color: rgba(255,255,255,0.6);
}

@media (max-width: 320px) {
    #screen-h { padding: 40px 20px; }
    .h-container { padding: 20px; }
    .h-visualization-section { flex-direction: column; gap: 30px; }
    .h-viz-result { aspect-ratio: 16/9; }
    .h-items-grid { grid-template-columns: repeat(2, 1fr); }
}



</style>
</head>

<body>

<div id="main-content">
    <div class="a-dot-pattern"></div>
    <canvas id="bubblePhysics"></canvas>
    <div class="a-footer-text">LOVE<br>ARCHIVE</div>
</div>

<div id="overlay-page">
    <div id="menu-container">
        <div id="menu-title" class="menu-text menu-title">LOVE ARCHIVE</div>
        <div id="mine-link" class="menu-text">MINE</div>
        <div id="others-link" class="menu-text">OTHERS</div>
        <div id="help-link" class="menu-text">HELP</div>

        <!-- 볼륨 조절 -->
        <div class="volume-control-container">
            <label for="volume-slider">MUSIC VOLUME</label>
            <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="0.5">
        </div>
    </div>

    <div id="menu-gray-box" class="music-box"></div>
    <div id="menu-gray-box2" class="music-box"></div>
    <div id="menu-gray-box3" class="scroll-box music-box"></div>
    <div id="menu-gray-box4" class="music-box"></div>
    <div id="menu-gray-box5" class="music-box"></div>
</div>

<div id="screen-e">
    <div class="dot-layer"></div>
    <div class="e-content">
        <div class="e-text">LOVE ARCHIVE</div>
        <div class="e-text desc-text">
            나의 사랑과 타인의 사랑을 비교해볼 수 있습니다.<br>
            이미지를 클릭해 노래를 재생할 수 있습니다. <br>
            MINE 에서 단어를 조합해 사랑을 시각화 할 수 있습니다. <br>
        </div>
        <div class="e-text" style="font-family:'Noto Sans KR',sans-serif;">
            CONTACT<br>MIEM4409@GMAIL.COM
        </div>
    </div>
</div>

<div id="screen-c">
    <div class="c-content">
        자신의 사랑과 유사하다고 느끼는 단어 여덟개를 골라주세요.
    </div>
</div>

<!-- 화면D -->
<div id="screen-d">
    <!-- 헤더 -->
    <div class="d-header">
        <div class="d-header-left">
            <div class="d-menu-item d-logo" id="back-to-menu">LOVE ARCHIVE</div>
            <div class="d-menu-item help-btn">HELP</div>
        </div>
        <div class="d-header-right">
            <div class="d-menu-item bag-count">BAG (0)</div>
        </div>
    </div>

    <div class="shop-grid">
        <!-- 1~24 Items -->
        <div class="shop-item" style="animation-delay: 0.1s;"><div class="item-img" style="background-image: url('https://i.imgur.com/yKmR6TT.jpg');"></div><div class="item-info"><h3>ROMANCE</h3><p>낭만<br>140,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.2s;"><div class="item-img" style="background-image: url('https://i.imgur.com/RSuMPFe.jpg');"></div><div class="item-info"><h3>CONSIDERATION</h3><p>배려<br>30,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.3s;"><div class="item-img" style="background-image: url('https://i.imgur.com/8LIPUcQ.jpg');"></div><div class="item-info"><h3>ESTEEM</h3><p>존중<br>4,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.4s;"><div class="item-img" style="background-image: url('https://i.imgur.com/mnoOZp1.jpg');"></div><div class="item-info"><h3>VALUE</h3><p>가치<br>42,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.5s;"><div class="item-img" style="background-image: url('https://i.imgur.com/mVJQKad.jpg');"></div><div class="item-info"><h3>FREE</h3><p>자유<br>27,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.6s;"><div class="item-img" style="background-image: url('https://i.imgur.com/cHie91i.jpg');"></div><div class="item-info"><h3>POSESSIVE</h3><p>소유<br>7,500원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.7s;"><div class="item-img" style="background-image: url('https://i.imgur.com/8hLzjww.jpg');"></div><div class="item-info"><h3>RESTRICTION</h3><p>구속<br>320,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.8s;"><div class="item-img" style="background-image: url('https://i.imgur.com/8om7HMM.jpg');"></div><div class="item-info"><h3>CARE</h3><p>보살핌<br>97,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 0.9s;"><div class="item-img" style="background-image: url('https://i.imgur.com/7KMuVHj.jpg');"></div><div class="item-info"><h3>DEPENDENCE</h3><p>의존<br>52,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.0s;"><div class="item-img" style="background-image: url('https://i.imgur.com/gISYdhi.jpg');"></div><div class="item-info"><h3>FAITH</h3><p>신뢰<br>82,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.1s;"><div class="item-img" style="background-image: url('https://i.imgur.com/jAIPBdO.jpg');"></div><div class="item-info"><h3>INTENSITY</h3><p>강렬함<br>15,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.2s;"><div class="item-img" style="background-image: url('https://i.imgur.com/ryrSFoS.jpg');"></div><div class="item-info"><h3>INQUIETUDE</h3><p>불안<br>22,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.3s;"><div class="item-img" style="background-image: url('https://i.imgur.com/406LQts.jpg');"></div><div class="item-info"><h3>FATE</h3><p>운명<br>8,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.4s;"><div class="item-img" style="background-image: url('https://i.imgur.com/SYn7kNy.jpg');"></div><div class="item-info"><h3>EXTORTION</h3><p>강요<br>40,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.5s;"><div class="item-img" style="background-image: url('https://i.imgur.com/AmlXNtB.jpg');"></div><div class="item-info"><h3>VISION</h3><p>환상<br>25,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.6s;"><div class="item-img" style="background-image: url('https://i.imgur.com/HSFxnf1.jpg');"></div><div class="item-info"><h3>COMMITMENT</h3><p>헌신<br>185,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.7s;"><div class="item-img" style="background-image: url('https://i.imgur.com/2ASOy2I.jpg');"></div><div class="item-info"><h3>JEALUSY</h3><p>질투<br>44,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.8s;"><div class="item-img" style="background-image: url('https://i.imgur.com/PKrC5EA.jpg');"></div><div class="item-info"><h3>LOGICAL</h3><p>논리<br>39,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 1.9s;"><div class="item-img" style="background-image: url('https://i.imgur.com/5cCsSgL.jpg');"></div><div class="item-info"><h3>PRACTICAL</h3><p>실용<br>110,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 2.0s;"><div class="item-img" style="background-image: url('https://i.imgur.com/DUezaDN.jpg');"></div><div class="item-info"><h3>ALTRUISM</h3><p>이타심<br>28,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 2.1s;"><div class="item-img" style="background-image: url('https://i.imgur.com/2p2TKp6.jpg');"></div><div class="item-info"><h3>FORGIVENESS</h3><p>용서<br>82,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 2.2s;"><div class="item-img" style="background-image: url('https://i.imgur.com/TouQLJL.jpg');"></div><div class="item-info"><h3>EVASION</h3><p>회피<br>12,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 2.3s;"><div class="item-img" style="background-image: url('https://i.imgur.com/3HbT2p7.jpg');"></div><div class="item-info"><h3>NAUGHTY</h3><p>장난스러운<br>23,000원</p></div></div>
        <div class="shop-item" style="animation-delay: 2.4s;"><div class="item-img" style="background-image: url('https://i.imgur.com/g7fapQM.jpg');"></div><div class="item-info"><h3>RESONABLE</h3><p>합리적인<br>51,000원</p></div></div>
          <div class="shop-item" style="animation-delay: 2.5s;">
            <div class="item-img" style="background-image: url('https://i.imgur.com/lyw6zWR.jpeg');"></div>
            <div class="item-info"><h3>CALCULATING</h3><p>계산적인<br>12,000</p></div>
        </div>

        <!-- 추가 아이템 2 -->
        <div class="shop-item" style="animation-delay: 2.6s;">
            <div class="item-img" style="background-image: url('https://i.imgur.com/fBtYXgA.jpeg');"></div>
            <div class="item-info"><h3>DISTRESS</h3><p>고통<br>4500</p></div>
        </div>

        <!-- 추가 아이템 3 -->
        <div class="shop-item" style="animation-delay: 2.7s;">
            <div class="item-img" style="background-image: url('https://i.imgur.com/xfERKMI.jpeg');"></div>
            <div class="item-info"><h3>SITUATIONSHIP</h3><p>애매한관계<br>40,000</p></div>
        </div>

        <!-- 추가 아이템 4 -->
        <div class="shop-item" style="animation-delay: 2.8s;">
            <div class="item-img" style="background-image: url('https://i.imgur.com/jZcqi8l.jpeg');"></div>
            <div class="item-info"><h3>TOLERANCE</h3><p>관용<br>152,000</p></div>
        </div>
    </div>
</div>

<!-- 8개 선택 시 뜨는 모달 -->
<div id="eight-modal">
    <div id="eight-modal-content">
        <div style="font-family:'Noto Sans KR', sans-serif; color:#000; font-size:18px; margin-bottom:35px; white-space:nowrap; font-weight:500; line-height:1.5;">
            장바구니로 이동하시겠습니까?
        </div>
        <div style="display:flex; gap:15px; justify-content:center;">
            <button onclick="closeEightModal()" style="font-family:'Elms Sans', sans-serif; font-weight:700; font-size:16px; background:transparent; color:#000; padding:12px 38px; border:2px solid #000; cursor:pointer;">
                아니오
            </button>
            <button onclick="goToBag()" style="font-family:'Elms Sans', sans-serif; font-weight:700; font-size:16px; background:#000; color:#fff; padding:12px 38px; border:none; cursor:pointer;">
                이동하기
            </button>
        </div>
    </div>
</div>

<!-- 화면F -->
<div id="screen-f">
    <div class="f-content">
        <div class="f-text desc-text">
            자신의 사랑과 비슷한 단어 8개를 골라주세요.<br>
            오른쪽 상단의 BAG 에 들어가서 주문을 확인해보세요.<br>
            주문을 완료하면 사랑에 대해 확인할 수 있습니다.
        </div>
    </div>
</div>

<!-- 로딩 화면 -->
<div id="loading-screen">
    <div class="heart-loader"></div>
</div>

<!-- 경고 모달 -->
<div id="warning-modal">
    <div class="msg" id="warning-msg">메시지</div>
    <button class="ok-btn" onclick="closeWarning()">확인</button>
</div>

<!-- 화면G -->
<div id="screen-g">
    <div class="g-header">
        <div class="g-title">ORDER LIST</div>
        <div class="g-close-btn" onclick="closeBag()">✕</div>
    </div>
    <div class="order-list" id="order-list"></div>
    
    <div class="order-summary-container">
        <div class="summary-line"></div>
        <div class="summary-row">
            <span>총 상품 금액</span>
            <span id="total-price">0원</span>
        </div>
        <div class="summary-row">
            <span>배송비</span>
            <span>0원</span>
        </div>
        <div class="summary-row total">
            <span>최종 결제 금액</span>
            <span id="final-price">0원</span>
        </div>
        <button class="order-btn" onclick="processOrder()">주문하기</button>
    </div>
</div>

<!-- 화면H -->
<div id="screen-h">
    <div class="h-container">
        <div class="h-header-info">
            <div>ORDER NO. 20231027-LA001</div>
            <div>DATE: 2023. 10. 27.</div>
            <div>STATUS: ORDER COMPLETED</div>
        </div>
        
        <div class="h-visualization-section">
            <div class="h-viz-result" style="position:relative; width:100%; height:100%; background:#111;">
                <canvas id="love-result-canvas" style="display:block; width:100%; height:100%;"></canvas>
            </div>
            <div class="h-viz-desc">
                <h3>Crystal of Emotion</h3>
                <p id="h-viz-text">
                    당신이 선택한 단어들이 모여...
                </p>
            </div>
        </div>

        <div class="h-items-section">
            <h4 id="h-items-title">Selected Items</h4>
            <div class="h-items-grid" id="h-items-grid"></div>
        </div>

        <div class="h-home-btn-container">
            <button class="h-home-btn" onclick="goToHome()">HOME</button>
        </div>
    </div>
</div>

<!-- 화면I: 타인의 주문 기록 -->
<div id="screen-i">
    
 <div class="order-history-list">
    <!-- 헤더 전체를 flex로 감싸서 제목과 X 높이 딱 맞춤 -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; width: 100%;">
        <h3 class="g-title" style="color: #fff; margin: 0;">LOVE RECEIPT</h3>
        <div class="g-close-btn" onclick="closeScreenI()" style="margin-left: 0;">✕</div>
    </div>

    <div class="i-fullwidth-stack">
    <!-- 카드 1 -->
    <div class="i-history-card fullwidth">
        <div class="i-preview-full" style="background-image:url('https://i.imgur.com/yKmR6TT.jpg');"></div>
        <div class="i-content">
            <div class="i-id">ID: 413B-A9F | 2024.03.15</div>
            <div class="i-type">Passionate Devotion</div>
            <div class="i-desc">끝없는 헌신과 감정의 조화</div>
        </div>
    </div>

    <!-- 카드 2~10 (같은 구조 반복) -->
    <div class="i-history-card fullwidth">
        <div class="i-preview-full" style="background-image:url('https://i.imgur.com/RSuMPFe.jpg');"></div>
        <div class="i-content">
            <div class="i-id">ID: 88C1-F3D | 2024.02.28</div>
            <div class="i-type">Quiet Longing</div>
            <div class="i-desc">조용하지만 깊은 그리움의 형태</div>
        </div>
    </div>

    <div class="i-history-card fullwidth">
        <div class="i-preview-full" style="background-image:url('https://i.imgur.com/8om7HMM.jpg');"></div>
        <div class="i-content">
            <div class="i-id">ID: 12E9-B22 | 2024.01.10</div>
            <div class="i-type">Turbulent Obsession</div>
            <div class="i-desc">혼란스럽고 강렬한 집착의 결정체</div>
        </div>
    </div>

    <!-- 나머지 7개 (이미지 랜덤으로 바꿔서 넣으세요) -->
    <div class="i-history-card fullwidth">
        <div class="i-preview-full" style="background-image:url('https://i.imgur.com/cHie91i.jpg');"></div>
        <div class="i-content">
            <div class="i-id">ID: 90A4-77E | 2023.12.22</div>
            <div class="i-type">Gentle Attachment</div>
            <div class="i-desc">부드럽고 안정적인 애착의 형태</div>
        </div>
    </div>

    <div class="i-history-card fullwidth">
        <div class="i-preview-full" style="background-image:url('https://i.imgur.com/8LIPUcQ.jpg');"></div>
        <div class="i-content">
            <div class="i-id">ID: 7F2K-91M | 2024.04.01</div>
            <div class="i-type">Idealistic Fantasy</div>
            <div class="i-desc">현실을 넘어선 낭만적 이상향</div>
        </div>
    </div>

    <!-- 생략 (총 10개까지) -->
</div>
        </div>
    </div>
</div>
>

<!-- 화면J -->
<div id="screen-j"></div>


<audio id="song1" loop preload="none"><source src="https://www.dropbox.com/scl/fi/w3pc9ouke2dhd0gtf06bs/Doja-Cat-Freak-Audio.mp3?dl=1" type="audio/mpeg"></audio>
<audio id="song2" loop preload="none"><source src="https://www.dropbox.com/scl/fi/iz0bbixbe6fgt7vpojv88/PENOMECO-AURORA.mp3?dl=1" type="audio/mpeg"></audio>
<audio id="song3" loop preload="none"><source src="https://www.dropbox.com/scl/fi/90ulvmrx7m4uw9m3r0m4r/Lana-Del-Rey-Freak.mp3?dl=1" type="audio/mpeg"></audio>
<audio id="song4" loop preload="none"><source src="https://www.dropbox.com/scl/fi/zra2mvs6mkriy3lpwsv8m/Redbone.mp3?dl=1" type="audio/mpeg"></audio>
<!-- [수정됨] 박스5 오디오: Colde - Control Me -->
<audio id="song5" loop preload="none"><source src="https://www.dropbox.com/scl/fi/kj09ihuk6ngb1kd2bofh3/MV-Colde-Control-Me.mp3?rlkey=8b7bab2zfhhuzedx7doyn1ehl&st=aamgdcpl&dl=1" type="audio/mpeg"></audio>

<script>
const $ = s => document.querySelector(s);
let firstVisit = true;

/* 버블 */
const canvas = $('#bubblePhysics');
const ctx = canvas.getContext('2d');
let bubbles = [], raf;

class Bubble {
    constructor(){ this.reset(); }
    reset(){
        this.x = Math.random()*canvas.width;
        this.y = canvas.height + Math.random()*200;
        this.r = 20 + Math.random()*60;
        this.speed = 0.4 + Math.random()*0.8;
        this.sway = 0.6 + Math.random()*1.4;
        this.phase = Math.random()*Math.PI*2;
    }
    update(){
        this.y -= this.speed;
        this.x += Math.sin(performance.now()*0.001 + this.phase) * this.sway;
        if(this.y < -this.r*2) this.reset();
    }
    draw(){
        ctx.save();
        ctx.globalAlpha = 0.8;
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 1.5;
        ctx.translate(this.x, this.y);
        ctx.beginPath();
        ctx.arc(0,0,this.r,0,Math.PI*2);
        ctx.stroke();
        ctx.restore();
    }
}

function init(){
    canvas.width = innerWidth;
    canvas.height = innerHeight;
    bubbles = [];
    const count = innerWidth < 768 ? 30 : 50;
    for(let i=0;i<count;i++) bubbles.push(new Bubble());
}
function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    bubbles.forEach(b=>{b.update();b.draw();});
    raf = requestAnimationFrame(loop);
}
function start(){ init(); loop(); }
function stop(){ cancelAnimationFrame(raf); }

start();
window.addEventListener('resize',()=>{stop();start();});

/* 화면A → 화면B */
$('#main-content').addEventListener('click', () => {
    // firstVisit 체크 없이 그냥 넘어가도록 수정 (ESC 버그 방지)
    stop();
    $('#main-content').style.display = 'none';
    $('#overlay-page').style.display = 'block';
    $('#overlay-page').classList.add('visible');
    document.body.style.overflow = 'auto';
});

/* HELP → 화면E */
$('#help-link').onclick = () => {
    $('#overlay-page').style.display = 'none';
    $('#screen-e').style.display = 'block';
    $('#screen-e').classList.remove('closing');
    requestAnimationFrame(() => $('#screen-e').classList.add('visible'));
};

/* 화면E 닫기 */
$('#screen-e').onclick = () => {
    $('#screen-e').classList.add('closing');
    $('#screen-e').classList.remove('visible');

    setTimeout(()=>{
        $('#screen-e').style.display = 'none';
        $('#overlay-page').style.display = 'block';
        $('#overlay-page').classList.add('visible');
    },900);
};

/* MINE → 화면C */
$('#mine-link').onclick = () => {
    $('#overlay-page').style.display = 'none';
    $('#screen-c').style.display = 'block';
};

/* 화면C 클릭 → 화면D */
$('#screen-c').onclick = () => {
    $('#screen-c').style.display = 'none';
    $('#screen-d').style.display = 'block';
};

/* 화면D HELP → 화면F */
$('#screen-d .help-btn').onclick = () => {
    $('#screen-f').style.display = 'block';
    requestAnimationFrame(() => {
        $('#screen-f').classList.add('visible');
    });
};

/* 화면F 닫기 */
$('#screen-f').onclick = () => {
    $('#screen-f').classList.remove('visible');
    setTimeout(() => {
        $('#screen-f').style.display = 'none';
    }, 500);
};

/* 경고 팝업 함수 */
function showWarning(msg) {
    $('#warning-msg').innerText = msg;
    $('#warning-modal').style.display = 'block';
}
function closeWarning() {
    $('#warning-modal').style.display = 'none';
}

/* 장바구니 기능 */
const shopItems = document.querySelectorAll('.shop-item');
const bagCountText = document.querySelector('.bag-count');

shopItems.forEach(item => {
    item.addEventListener('click', () => {
        if (item.classList.contains('selected')) {
            item.classList.remove('selected');
        } else {
            const currentSelected = document.querySelectorAll('.shop-item.selected').length;
            if (currentSelected >= 8) {
                // 8개가 이미 선택되어 있다면 경고 없이 리턴 (또는 알림)
                // checkEightSelected()가 있으니 여기선 패스
            }
            item.classList.add('selected');
        }
        updateBagCount();
    });
});

function updateBagCount() {
    const count = document.querySelectorAll('.shop-item.selected').length;
    bagCountText.innerText = `BAG (${count})`;
    checkEightSelected(); // 8개 체크
}

// 8개 선택했는지 감지해서 모달 띄우기
function checkEightSelected() {
    const selected = document.querySelectorAll('.shop-item.selected').length;
    if (selected === 8) {
        document.getElementById('eight-modal').style.display = 'flex';
    }
}

// 모달 닫기
function closeEightModal() {
    document.getElementById('eight-modal').style.display = 'none';
}

// 장바구니로 이동
function goToBag() {
    closeEightModal();
    $('.bag-count').click(); 
}


/* BAG 클릭 -> 화면G 열기 */
$('.bag-count').onclick = () => {
    const selectedItems = document.querySelectorAll('.shop-item.selected');
    const count = selectedItems.length;

    if (count < 8) {
        showWarning('사랑의 단어 8개를\n모두 채워주세요.');
        return;
    }

    const orderListContainer = $('#order-list');
    orderListContainer.innerHTML = '';

    let totalPrice = 0;

    selectedItems.forEach(item => {
        // 이미지 주소 정확히 가져오기 (url(...) 제거)
        const rawBg = item.querySelector('.item-img').style.backgroundImage;
        const bgUrl = rawBg.slice(5, -2).replace(/['"]/g, ""); 

        const title = item.querySelector('h3').innerText;
        const desc = item.querySelector('p').innerText;

        const div = document.createElement('div');
        div.className = 'order-item';
        div.innerHTML = `
            <img class="item-img" src="${bgUrl}" alt="${title}">
            <div class="item-info"><h3>${title}</h3><p>${desc}</p></div>
        `;
        orderListContainer.appendChild(div);

        const priceMatch = desc.match(/([0-9,]+)원/);
        if (priceMatch) {
            const priceNum = parseInt(priceMatch[1].replace(/,/g, ''), 10);
            totalPrice += priceNum;
        }
    });

    $('#total-price').innerText = totalPrice.toLocaleString() + '원';
    
    // 취소선 적용
    const finalPriceEl = $('#final-price');
    finalPriceEl.innerText = totalPrice.toLocaleString() + '원';
    finalPriceEl.style.textDecoration = 'line-through';
    finalPriceEl.style.color = '#888';

    $('#screen-d').style.display = 'none';
    $('#screen-g').style.display = 'block';
};

/* [수정됨] 단어 유형 분석 및 랜덤 텍스트 생성 함수 */
function buildScreenHContent(selectedItems) {
    const hItemsGrid = document.getElementById('h-items-grid');
    const hVizText = document.getElementById('h-viz-text');
    const hItemsTitle = document.getElementById('h-items-title');
    
    // 원래 있던 제목 요소가 없다면 가져오거나(없으면 무시)
    // 기존 코드에 h-viz-desc 안에 h3 태그가 있으니 거기를 타겟팅합니다.
    const hVizTitle = document.querySelector('.h-viz-desc h3'); 

    hItemsGrid.innerHTML = '';
    
    // 1. 단어별 유형 데이터 (Mapping)
    const wordCategory = {
        "ROMANCE": "Eros", "INTENSITY": "Eros", "FATE": "Eros", "VISION": "Eros", 
        "COMMITMENT": "Eros", "NAUGHTY": "Eros", "FREE": "Eros", "JEALUSY": "Eros",
        "EVASION": "Ludus", "SITUATIONSHIP": "Ludus", "CALCULATING": "Ludus",
        "LOGICAL": "Pragma", "PRACTICAL": "Pragma", "RESONABLE": "Pragma",
        "POSESSIVE": "Mania", "RESTRICTION": "Mania", "DEPENDENCE": "Mania", 
        "INQUIETUDE": "Mania", "EXTORTION": "Mania", "DISTRESS": "Mania",
        "CONSIDERATION": "Storge", "ESTEEM": "Storge", "CARE": "Storge", 
        "FAITH": "Storge", "VALUE": "Storge", "TOLERANCE": "Storge", 
        "ALTRUISM": "Storge", "FORGIVENESS": "Storge" 
    };

    let scores = { Eros: 0, Ludus: 0, Pragma: 0, Mania: 0, Storge: 0 };
    
    // 2. 선택된 아이템들로 점수 계산 및 리스트 생성
    selectedItems.forEach(item => {
        // 이미지 주소 가져오기
        const rawBg = item.querySelector('.item-img').style.backgroundImage;
        // url("...") 형태에서 주소만 깔끔하게 추출
        const bgUrl = rawBg.slice(5, -2).replace(/['"]/g, "");

        const title = item.querySelector('h3').innerText;
        const desc = item.querySelector('p').innerText.split('\n')[0];

        // 점수 집계
        let type = wordCategory[title];
        if(type) scores[type]++;

        // 리스트 아이템 생성
        const div = document.createElement('div');
        div.className = 'h-item';
        div.innerHTML = `
            <div class="h-item-img" style="background-image: url('${bgUrl}')"></div>
            <div class="h-item-info"><h5>${title}</h5><p>${desc}</p></div>
        `;
        hItemsGrid.appendChild(div);
    });

    // 3. 최다 점수 유형 찾기 (동점일 경우 앞선 순서)
    let maxScore = -1;
    let resultType = "Eros"; // 기본값
    for (const [key, value] of Object.entries(scores)) {
        if (value > maxScore) {
            maxScore = value;
            resultType = key;
        }
    }

    // 4. 유형별 랜덤 설명글 데이터 (각 2개씩)
    const typeDescriptionsData = {
        "Eros": [
            "당신의 사랑은 한여름의 태양처럼 뜨겁고 강렬합니다. <br>운명적인 이끌림을 믿으며, 순간의 감정에 온전히 몰입하는 낭만적인 에너지를 가지고 있습니다.",
            "서로의 영혼이 불타오르는 듯한 깊은 일체감을 원합니다.<br>첫눈에 반하는 운명을 믿으며, 상대방에게 끊임없이 자신의 열정을 표현하는 스타일입니다."
        ],
        "Ludus": [
            "사랑은 즐거운 놀이이자 흥미로운 게임이라고 생각합니다.<br>깊은 구속보다는 자유로운 관계를 선호하며, 서로에게 부담을 주지 않는 산뜻한 만남을 추구합니다.",
            "심각한 감정보다는*순간의 즐거움과 위트를 중요시합니다.<br>얽매이지 않는 자유로운 영혼을 가졌으며, 다양한 경험을 통해 사랑의 재미를 찾습니다."
        ],
        "Pragma": [
            "사랑은 현실적인 조화와 논리적인 판단위에 세워져야 한다고 믿습니다.<br>감정에 휩쓸리기보다는 서로의 조건과 미래를 신중하게 고려하여 안정적인 관계를 만들어갑니다.",
            "뜨거운 가슴보다는 차가운 머리로 사랑을 합니다.<br>상대방과의 호환성을 꼼꼼히 따지며, 장기적으로 함께 성장할 수 있는 합리적인 파트너십을 추구합니다."
        ],
        "Mania": [
            "당신의 사랑은 폭풍우처럼 격정적이고 소유욕이 강합니다.<br>상대방과 24시간 함께하고 싶어 하며, 사랑받고 있다는 끊임없는 확인을 통해 안정을 찾습니다.",
            "불안과 환희 사이를 오가는 롤러코스터 같은 사랑을 합니다.<br>상대방이 나의 전부가 되길 원하며, 그만큼 깊고 진한 감정의 소용돌이 속에 있습니다."
        ],
        "Storge": [
            "오랜 친구처럼 편안하고 신뢰 깊은 사랑을 추구합니다.<br>불타오르는 열정보다는, 서로의 곁을 묵묵히 지켜주며 서서히 스며드는 따뜻한 온기 같은 관계입니다.",
            "상대방의 행복을 위해 기꺼이 양보하고 헌신하는 이타적인 마음을 가졌습니다.<br>조건 없는 믿음을 바탕으로 흔들리지 않는 뿌리 깊은 나무 같은 사랑을 합니다."
        ]
    };

    // 5. 랜덤 선택 (0 또는 1)
    const descArray = typeDescriptionsData[resultType] || typeDescriptionsData["Eros"];
    const randomDesc = descArray[Math.floor(Math.random() * descArray.length)];

    // 6. 화면에 텍스트 적용
    hItemsTitle.innerText = `Selected Items (${selectedItems.length})`;
    
    // 제목 변경 (Crystal of Emotion -> 결과 유형)
    if(hVizTitle) hVizTitle.innerText = `${resultType} Type`;
    
    // 설명글 변경
    hVizText.innerHTML = randomDesc;

    // (애니메이션을 위해 결과 타입을 반환합니다)
    return resultType; 
}

/* [신규 함수] 화면J 내용 생성 (타인 기록 상세) */
function buildScreenJContent(id, date, type, summary) {
    const screenJ = document.getElementById('screen-j');
    
    screenJ.innerHTML = `
        <div class="j-container">
            <div class="j-close-btn" onclick="closeScreenJ()">✕</div>
            
            <div class="h-header-info">
                <div>ORDER NO. ${id}</div>
                <div>DATE: ${date}</div>
                <div>STATUS: ARCHIVE RECORD</div>
            </div>
            
            <div class="h-visualization-section">
                <div class="h-viz-result">
                    <div class="viz-core"></div>
                    <div class="viz-particle" style="top:30%;left:40%;animation:pulseCore 2.2s infinite -0.5s"></div>
                    <div class="viz-particle" style="top:60%;left:70%;animation:pulseCore 2.5s infinite -1s"></div>
                </div>
                <div class="h-viz-desc">
                    <h3>Love Type: ${type}</h3>
                    <p>
                        이 기록은 타인의 사랑 기록입니다.<br>
                        ${type}은(는) ${summary}.<br>
                        고유한 형태의 감정들이 중심을 향해 응집되어 있습니다.
                    </p>
                </div>
            </div>

            <div class="h-items-section">
                <h4>Items in Archive (8)</h4>
                <div class="h-items-grid">
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/yKmR6TT.jpg');"></div><div class="h-item-info"><h5>ROMANCE</h5><p>낭만</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/RSuMPFe.jpg');"></div><div class="h-item-info"><h5>CONSIDERATION</h5><p>배려</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/8LIPUcQ.jpg');"></div><div class="h-item-info"><h5>VINTAGE TV</h5><p>과거의 회상</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/mnoOZp1.jpg');"></div><div class="h-item-info"><h5>RED LAMP</h5><p>열정의 빛</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/mVJQKad.jpg');"></div><div class="h-item-info"><h5>GLASS VASE</h5><p>투명한 마음</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/cHie91i.jpg');"></div><div class="h-item-info"><h5>FILM CAMERA</h5><p>기록</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/8hLzjww.jpg');"></div><div class="h-item-info"><h5>SOFT PILLOW</h5><p>포옹</p></div></div>
                    <div class="h-item"><div class="h-item-img" style="background-image: url('https://i.imgur.com/8om7HMM.jpg');"></div><div class="h-item-info"><h5>WHITE OBJECT</h5><p>형태 없는 사랑</p></div></div>
                </div>
            </div>

            <div class="h-home-btn-container">
                <button class="h-home-btn" onclick="closeScreenJ()">RETURN TO HISTORY</button>
            </div>
        </div>
    `;
}

// -----------------------------------------------------
// [신규] 캔버스 애니메이션 클래스 (Pearl Effect)
// -----------------------------------------------------
class LoveParticle {
    constructor(canvas, x, y, type, subtype = 'main') {
        this.canvas = canvas;
        this.type = type;
        this.subtype = subtype;
        this.reset(x, y);
    }

    reset(x, y) {
        this.x = x || Math.random() * this.canvas.width;
        this.y = y || Math.random() * this.canvas.height;
        this.alpha = 1;
        this.markedForDeletion = false;

        if (this.type === 'Eros') {
            if (this.subtype === 'main') {
                this.y = this.canvas.height / 2;
                this.size = 20;
                this.color = '#ff3366'; 
                this.state = 'stretching'; 
                this.stretchDist = 0;
            } else {
                this.angle = Math.random() * Math.PI * 2;
                this.speed = Math.random() * 8 + 2;
                this.friction = 0.95;
                this.gravity = 0.1;
                this.size = Math.random() * 4 + 2;
                this.color = `hsl(${340 + Math.random() * 20}, 100%, 70%)`;
            }
        } 
        else if (this.type === 'Storge') {
            this.x = Math.random() * this.canvas.width;
            this.y = this.canvas.height + 50; 
            this.speedY = Math.random() * 1 + 0.5; 
            this.size = Math.random() * 15 + 10;
            this.pulse = Math.random() * Math.PI; 
            this.color = `hsla(${160 + Math.random() * 40}, 70%, 80%, 0.6)`; 
        }
        else if (this.type === 'Mania') {
            if (this.subtype === 'main') {
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8;
                this.size = 15;
                this.mass = 1;
                this.color = '#8a2be2'; 
            } else {
                this.vx = (Math.random() - 0.5) * 6;
                this.vy = (Math.random() - 1) * 6; 
                this.gravity = 0.4;
                this.size = Math.random() * 3 + 1;
                this.color = '#aa0000'; 
            }
        }
        else {
            // Ludus/Pragma 등 기본
            this.angle = Math.random() * Math.PI * 2;
            this.speed = Math.random() * 2 + 1;
            this.size = 6;
            this.friction = 0.98;
            this.color = '#ffffff';
        }
    }

    update(ctx, allParticles) {
        if (this.type === 'Eros') {
            if (this.subtype === 'main') {
                // Controlled by animate loop
            } else {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed + this.gravity;
                this.speed *= this.friction;
                this.alpha -= 0.02;
                if (this.alpha <= 0) this.markedForDeletion = true;
            }
        }
        else if (this.type === 'Storge') {
            this.y -= this.speedY;
            this.x += Math.sin(this.y * 0.02 + this.pulse) * 0.5;
            this.pulse += 0.05;
            this.currentSize = this.size + Math.sin(this.pulse) * 3;
            if (this.y < -50) this.reset();
        }
        else if (this.type === 'Mania') {
            if (this.subtype === 'main') {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < this.size || this.x > this.canvas.width - this.size) this.vx *= -1;
                if (this.y < this.size || this.y > this.canvas.height - this.size) this.vy *= -1;

                for (let other of allParticles) {
                    if (other === this || other.subtype !== 'main') continue;
                    const dx = other.x - this.x;
                    const dy = other.y - this.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < this.size + other.size) {
                        this.vx *= -1; this.vy *= -1;
                        other.vx *= -1; other.vy *= -1;
                        this.collided = true; 
                    }
                }
            } else {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += this.gravity;
                this.alpha -= 0.02;
                if (this.y > this.canvas.height || this.alpha <= 0) this.markedForDeletion = true;
            }
        }
        else {
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;
            this.speed *= this.friction;
            this.alpha -= 0.01;
            if (this.alpha <= 0) this.reset();
        }
    }

    draw(ctx) {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        
        if (this.type === 'Eros' && this.subtype === 'debris') {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
            ctx.fill();
        } 
        else if (this.type === 'Storge') {
            const grad = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.currentSize);
            grad.addColorStop(0, "rgba(255,255,255,0.8)");
            grad.addColorStop(0.5, this.color);
            grad.addColorStop(1, "rgba(255,255,255,0)");
            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.currentSize, 0, Math.PI*2);
            ctx.fill();
        } 
        else if (this.type === 'Mania') {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            if (this.subtype === 'main') {
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
            } else {
                ctx.rect(this.x, this.y, this.size, this.size);
            }
            ctx.fill();
        }
        else if (this.type !== 'Eros') { 
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
            ctx.fill();
        }
        
        ctx.restore();
    }
}

let loveAnimId;
function startLoveAnimation(canvasId, type) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    
    // Resize
    const container = canvas.parentElement;
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;

    let particles = [];
    
    // --- 초기 입자 생성 ---
    if (type === 'Eros') {
        // 에로스는 상태 변수로 제어
    } 
    else if (type === 'Storge') {
        for(let i=0; i<15; i++) particles.push(new LoveParticle(canvas, null, null, 'Storge'));
    } 
    else if (type === 'Mania') {
        for(let i=0; i<5; i++) particles.push(new LoveParticle(canvas, null, null, 'Mania', 'main'));
    }
    else {
        for(let i=0; i<20; i++) particles.push(new LoveParticle(canvas, null, null, type));
    }

    // 에로스 전용 변수
    let erosState = { phase: 'stretch', dist: 0, maxDist: 150, timer: 0 };

    function animate() {
        ctx.fillStyle = 'rgba(17, 17, 17, 0.2)'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Eros Logic
        if (type === 'Eros') {
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            if (erosState.phase === 'stretch') {
                erosState.dist += 2;
                if (erosState.dist >= erosState.maxDist) erosState.phase = 'snap';
            } 
            else if (erosState.phase === 'snap') {
                erosState.dist -= 15;
                if (erosState.dist <= 0) {
                    erosState.dist = 0;
                    erosState.phase = 'explode';
                    for(let i=0; i<50; i++) particles.push(new LoveParticle(canvas, cx, cy, 'Eros', 'debris'));
                }
            } 
            else if (erosState.phase === 'explode') {
                erosState.timer++;
                if (erosState.timer > 60) {
                    erosState.timer = 0;
                    erosState.phase = 'stretch';
                }
            }

            if (erosState.phase !== 'explode' || erosState.timer < 5) {
                ctx.save();
                ctx.fillStyle = '#ff3366';
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#ff0033';
                if (erosState.dist > 0) {
                    const thickness = 40 * (1 - erosState.dist / erosState.maxDist) + 2;
                    ctx.beginPath();
                    ctx.rect(cx - erosState.dist, cy - thickness/2, erosState.dist * 2, thickness);
                    ctx.fill();
                }
                ctx.beginPath();
                ctx.arc(cx - erosState.dist, cy, 20, 0, Math.PI*2);
                ctx.arc(cx + erosState.dist, cy, 20, 0, Math.PI*2);
                ctx.fill();
                ctx.restore();
            }
        }

        // Particle Update
        particles.forEach((p) => {
            p.update(ctx, particles);
            p.draw(ctx);

            if (p.type === 'Mania' && p.collided) {
                p.collided = false;
                for(let k=0; k<5; k++) {
                    particles.push(new LoveParticle(canvas, p.x, p.y, 'Mania', 'debris'));
                }
            }
        });

        particles = particles.filter(p => !p.markedForDeletion);

        loveAnimId = requestAnimationFrame(animate);
    }
    
    cancelAnimationFrame(loveAnimId); 
    animate();
}


/* 주문하기 버튼 동작 */
function processOrder() {
    $('#screen-g').style.display = 'none';
    const loader = $('#loading-screen');
    loader.style.display = 'flex';
    
    const selectedItems = document.querySelectorAll('.shop-item.selected');
    buildScreenHContent(selectedItems);
    const resultType = buildScreenHContent(selectedItems);
    
    setTimeout(() => {
        loader.style.display = 'none';
        $('#screen-h').style.display = 'block';
        setTimeout(() => {
            startLoveAnimation('love-result-canvas', resultType); 
        }, 100);

    }, 2500);
}

/* HOME 버튼 */
function goToHome() {
    $('#screen-h').style.display = 'none';
    $('#overlay-page').style.display = 'block';
    $('#overlay-page').classList.add('visible');
    
    // 애니메이션 정지
    cancelAnimationFrame(loveAnimId);

    // 초기화
    document.querySelectorAll('.shop-item.selected').forEach(item => item.classList.remove('selected'));
    document.querySelector('.bag-count').innerText = 'BAG (0)';
    $('#order-list').innerHTML = '';
    $('#total-price').innerText = '0원';
    $('#final-price').innerText = '0원';
}

/* 화면G 닫기 */
function closeBag() {
    $('#screen-g').style.display = 'none';
    $('#screen-d').style.display = 'block';
}

/* 음악 및 볼륨 */
let p1=p2=p3=p4=p5=false;
const volumeSlider = $('#volume-slider');
const allAudios = document.querySelectorAll('audio');

// Helper to safe toggle
function toggleMusic(e, audioSelector, boxSelector) {
    e.stopPropagation();
    const audio = $(audioSelector);
    const box = $(boxSelector);
    
    if (audio.paused) {
        audio.play().catch(e => console.log('Playback interrupted:', e));
        box.classList.add('playing');
    } else {
        audio.pause();
        box.classList.remove('playing');
    }
}

allAudios.forEach(audio => { audio.volume = volumeSlider.value; });
volumeSlider.addEventListener('input', (e) => {
    const newVolume = e.target.value;
    allAudios.forEach(audio => { audio.volume = newVolume; });
});

$('#menu-gray-box').onclick = e => toggleMusic(e, '#song1', '#menu-gray-box');
$('#menu-gray-box2').onclick = e => toggleMusic(e, '#song2', '#menu-gray-box2');
$('#menu-gray-box3').onclick = e => toggleMusic(e, '#song3', '#menu-gray-box3');
$('#menu-gray-box4').onclick = e => toggleMusic(e, '#song4', '#menu-gray-box4');
$('#menu-gray-box5').onclick = e => toggleMusic(e, '#song5', '#menu-gray-box5');


/* OTHERS → 화면I 열기 */
$('#others-link').onclick = () => {
    $('#overlay-page').style.display = 'none';
    $('#screen-i').style.display = 'block';
};

/* -----------------------------------------------------------
   [신규] 유형별 아이템 데이터베이스 (여기서 8개씩 짝지어줍니다)
   ----------------------------------------------------------- */
const typePresets = {
    "Passionate Devotion": [ // Eros (열정)
        { title: "ROMANCE", desc: "낭만", img: "https://i.imgur.com/yKmR6TT.jpg" },
        { title: "INTENSITY", desc: "강렬함", img: "https://i.imgur.com/jAIPBdO.jpg" },
        { title: "FATE", desc: "운명", img: "https://i.imgur.com/406LQts.jpg" },
        { title: "VISION", desc: "환상", img: "https://i.imgur.com/AmlXNtB.jpg" },
        { title: "COMMITMENT", desc: "헌신", img: "https://i.imgur.com/HSFxnf1.jpg" },
        { title: "NAUGHTY", desc: "장난스러운", img: "https://i.imgur.com/3HbT2p7.jpg" },
        { title: "FREE", desc: "자유", img: "https://i.imgur.com/mVJQKad.jpg" },
        { title: "JEALUSY", desc: "질투", img: "https://i.imgur.com/2ASOy2I.jpg" }
    ],
    "Quiet Longing": [ // Storge (안정/우정)
        { title: "CONSIDERATION", desc: "배려", img: "https://i.imgur.com/RSuMPFe.jpg" },
        { title: "ESTEEM", desc: "존중", img: "https://i.imgur.com/8LIPUcQ.jpg" },
        { title: "CARE", desc: "보살핌", img: "https://i.imgur.com/8om7HMM.jpg" },
        { title: "FAITH", desc: "신뢰", img: "https://i.imgur.com/gISYdhi.jpg" },
        { title: "VALUE", desc: "가치", img: "https://i.imgur.com/mnoOZp1.jpg" },
        { title: "ALTRUISM", desc: "이타심", img: "https://i.imgur.com/DUezaDN.jpg" },
        { title: "FORGIVENESS", desc: "용서", img: "https://i.imgur.com/2p2TKp6.jpg" },
        { title: "SOFT PILLOW", desc: "포옹", img: "https://i.imgur.com/8hLzjww.jpg" }
    ],
    "Turbulent Obsession": [ // Mania (집착)
        { title: "POSESSIVE", desc: "소유", img: "https://i.imgur.com/cHie91i.jpg" },
        { title: "RESTRICTION", desc: "구속", img: "https://i.imgur.com/8hLzjww.jpg" },
        { title: "DEPENDENCE", desc: "의존", img: "https://i.imgur.com/7KMuVHj.jpg" },
        { title: "INQUIETUDE", desc: "불안", img: "https://i.imgur.com/ryrSFoS.jpg" },
        { title: "EXTORTION", desc: "강요", img: "https://i.imgur.com/SYn7kNy.jpg" },
        { title: "JEALUSY", desc: "질투", img: "https://i.imgur.com/2ASOy2I.jpg" },
        { title: "RED LAMP", desc: "경고", img: "https://i.imgur.com/mnoOZp1.jpg" },
        { title: "EVASION", desc: "회피", img: "https://i.imgur.com/TouQLJL.jpg" }
    ],
    "Gentle Attachment": [ // Storge (안정)
        { title: "GLASS VASE", desc: "투명함", img: "https://i.imgur.com/mVJQKad.jpg" },
        { title: "CARE", desc: "보살핌", img: "https://i.imgur.com/8om7HMM.jpg" },
        { title: "SOFT PILLOW", desc: "안락함", img: "https://i.imgur.com/8hLzjww.jpg" },
        { title: "FAITH", desc: "믿음", img: "https://i.imgur.com/gISYdhi.jpg" },
        { title: "VINTAGE TV", desc: "추억", img: "https://i.imgur.com/8LIPUcQ.jpg" },
        { title: "FILM CAMERA", desc: "기록", img: "https://i.imgur.com/cHie91i.jpg" },
        { title: "ESTEEM", desc: "존중", img: "https://i.imgur.com/8LIPUcQ.jpg" },
        { title: "COMMITMENT", desc: "헌신", img: "https://i.imgur.com/HSFxnf1.jpg" }
    ],
    "Idealistic Fantasy": [ // Pragma + Ludus
        { title: "VISION", desc: "환상", img: "https://i.imgur.com/AmlXNtB.jpg" },
        { title: "FATE", desc: "운명", img: "https://i.imgur.com/406LQts.jpg" },
        { title: "ROMANCE", desc: "낭만", img: "https://i.imgur.com/yKmR6TT.jpg" },
        { title: "FREE", desc: "자유", img: "https://i.imgur.com/mVJQKad.jpg" },
        { title: "NAUGHTY", desc: "유희", img: "https://i.imgur.com/3HbT2p7.jpg" },
        { title: "LOGICAL", desc: "논리", img: "https://i.imgur.com/PKrC5EA.jpg" },
        { title: "PRACTICAL", desc: "실용", img: "https://i.imgur.com/5cCsSgL.jpg" },
        { title: "RESONABLE", desc: "합리", img: "https://i.imgur.com/g7fapQM.jpg" }
    ]
};


/* [수정됨] 화면I 카드 클릭 -> 데이터 매칭해서 화면J 열기 */
const iHistoryCards = document.querySelectorAll('.i-history-card');
iHistoryCards.forEach(card => {
    card.addEventListener('click', (e) => {
        // 1. 카드에서 기본 정보 추출
        const idElem = card.querySelector('.i-id') || card.querySelector('.i-id-data');
        const typeElem = card.querySelector('.i-type') || card.querySelector('.i-love-type');
        const descElem = card.querySelector('.i-desc') || card.querySelector('.i-summary');

        if (!idElem || !typeElem) return;

        const idText = idElem.innerText;
        const cardId = idText.split('|')[0].trim();
        const cardDate = idText.split('|')[1]?.trim() || "Unknown";
        
        const cardTypeFull = typeElem.innerText; // 예: "Passionate Devotion"
        const cardSummary = descElem ? descElem.innerText : "";

        // 2. 텍스트에서 핵심 유형 이름만 추출 (예: "Type: **Passionate** (8 items)" -> "Passionate")
        // 화면 I의 HTML 구조에 따라 텍스트가 다를 수 있으므로 정제
        let typeKey = "Passionate Devotion"; // 기본값

        if (cardTypeFull.includes("Passionate")) typeKey = "Passionate Devotion";
        else if (cardTypeFull.includes("Quiet")) typeKey = "Quiet Longing";
        else if (cardTypeFull.includes("Turbulent") || cardTypeFull.includes("Obsession")) typeKey = "Turbulent Obsession";
        else if (cardTypeFull.includes("Gentle")) typeKey = "Gentle Attachment";
        else if (cardTypeFull.includes("Idealistic")) typeKey = "Idealistic Fantasy";
        else if (cardTypeFull.includes("Ephemeral")) typeKey = "Quiet Longing"; // 매핑 없는 경우 예비

        // 3. 해당 유형에 맞는 8개 아이템 가져오기
        const items = typePresets[typeKey] || typePresets["Passionate Devotion"];

        // 4. 애니메이션 타입 결정 (Eros, Ludus 등)
        let animType = "Eros";
        if (typeKey.includes("Passionate")) animType = "Eros";
        else if (typeKey.includes("Quiet") || typeKey.includes("Gentle")) animType = "Storge";
        else if (typeKey.includes("Turbulent")) animType = "Mania";
        else if (typeKey.includes("Idealistic")) animType = "Pragma";
        
        // 5. 화면 J 생성 및 이동
        buildScreenJContent(cardId, cardDate, typeKey, cardSummary, items);
        $('#screen-i').style.display = 'none';
        $('#screen-j').style.display = 'block';

        // 6. 애니메이션 시작
        setTimeout(() => {
            startLoveAnimation('love-result-canvas-j', animType);
        }, 100);
    });
});

/* 화면J 닫기 */
/* [수정됨] 화면J 컨텐츠 생성: 타입별 상세 설명글 추가됨 */
/* [수정됨] 화면J 컨텐츠 생성: 제목 텍스트를 타입으로 변환하여 설명글 매칭 */
function buildScreenJContent(id, date, rawType, summary) {
    const screenJ = document.getElementById('screen-j');

    // 1. 전달받은 제목(rawType)을 키워드(Key)로 변환
    let typeKey = "Eros"; // 기본값
    if (rawType.includes("Passionate")) typeKey = "Eros";
    else if (rawType.includes("Ephemeral") || rawType.includes("Ludus")) typeKey = "Ludus";
    else if (rawType.includes("Quiet") || rawType.includes("Gentle") || rawType.includes("Storge")) typeKey = "Storge";
    else if (rawType.includes("Turbulent") || rawType.includes("Obsession") || rawType.includes("Mania")) typeKey = "Mania";
    else if (rawType.includes("Idealistic") || rawType.includes("Pragma")) typeKey = "Pragma";

    // 2. 타입별 상세 설명글 데이터
    const typeDescriptions = {
        "Eros": "운명적인 이끌림을 믿으며, 순간의 감정에 온전히 몰입하는<br> 낭만적인 에너지를 가지고 있습니다.<br>서로의 영혼이 불타오르는 듯한 깊은 일체감을 원합니다.",
        "Ludus": "사랑은 즐거운 놀이이자 흥미로운 게임이라고 생각합니다.<br>깊은 구속보다는 자유로운 관계를 선호하며, 서로에게 부담을 주지 않는 산뜻한 만남을 추구합니다.",
        "Storge": "오랜 친구처럼 편안하고 신뢰 깊은 사랑을 추구합니다.<br>불타오르는 열정보다는, 서로의 곁을 묵묵히 지켜주며 서서히<br> 스며드는 따뜻한 온기 같은 관계입니다.",
        "Mania": "폭풍우처럼 격정적이고 소유욕이 강합니다.<br>불안과 환희 사이를 오가는 롤러코스터 같은 사랑을 하며 상대방이 나의 전부가 되길 원합니다.",
        "Pragma": "사랑은 현실적인 조화와 논리적인 판단이 중요하다고 믿습니다.<br>감정에 휩쓸리기보다는 서로의 조건과 미래를 신중하게 고려하여 안정적인 관계를 만들어갑니다."
    };

    // 3. 변환된 키(typeKey)로 설명글 찾기
    const detailedDesc = typeDescriptions[typeKey] || summary;

    // 4. 아이템 리스트 매핑 (제목에 맞춰 프리셋 찾기)
    // typePresets의 키는 "Passionate Devotion" 같은 풀네임을 사용하므로 rawType을 활용하거나 매핑 필요
    // 여기서는 안전하게 typeKey를 다시 풀네임 키로 매핑
    let presetKey = "Passionate Devotion";
    if (typeKey === "Eros") presetKey = "Passionate Devotion";
    else if (typeKey === "Ludus") presetKey = "Idealistic Fantasy"; // Ludus용 데이터가 없다면 대체
    else if (typeKey === "Storge") presetKey = "Quiet Longing";
    else if (typeKey === "Mania") presetKey = "Turbulent Obsession";
    else if (typeKey === "Pragma") presetKey = "Idealistic Fantasy";
    
    // 예외 처리: Gentle은 Storge지만 프리셋은 따로 있음
    if (rawType.includes("Gentle")) presetKey = "Gentle Attachment";

    const items = typePresets[presetKey] || typePresets["Passionate Devotion"];

    // 5. 아이템 HTML 생성
    const itemsHtml = items.map(item => `
        <div class="h-item">
            <div class="h-item-img" style="background-image: url('${item.img}');"></div>
            <div class="h-item-info"><h5>${item.title}</h5><p>${item.desc}</p></div>
        </div>
    `).join('');

    // 6. 화면 구성
    screenJ.innerHTML = `
        <div class="j-container">
            <div class="j-close-btn" onclick="closeScreenJ()">✕</div>
            
            <div class="h-header-info">
                <div>ORDER NO. ${id}</div>
                <div>DATE: ${date}</div>
                <div>STATUS: ARCHIVE RECORD</div>
            </div>
            
            <div class="h-visualization-section">
                <div class="h-viz-result" style="position:relative; width:100%; height:100%; background:#111;">
                     <canvas id="love-result-canvas-j" style="display:block; width:100%; height:100%;"></canvas>
                </div>
                <div class="h-viz-desc">
                    <!-- 원본 제목(rawType) 표시 -->
                    <h3>${rawType}</h3>
                    <p>
                        ${detailedDesc}
                    </p>
                </div>
            </div>

            <div class="h-items-section">
                <h4>Items in Archive (8)</h4>
                <div class="h-items-grid">
                    ${itemsHtml}
                </div>
            </div>

            <div class="h-home-btn-container">
                <button class="h-home-btn" onclick="closeScreenJ()">RETURN TO LIST</button>
            </div>
        </div>
    `;
}

/* 화면D LOVE ARCHIVE 누르면 메뉴로 돌아가기 */
document.getElementById('back-to-menu').onclick = function() {
    document.getElementById('screen-d').style.display = 'none';
    document.getElementById('overlay-page').style.display = 'block';
    document.getElementById('overlay-page').classList.add('visible');
};
/* 화면I 닫기 (X 버튼 및 ESC용) */
function closeScreenI() {
    document.getElementById('screen-i').style.display = 'none';
    document.getElementById('overlay-page').style.display = 'block';
    
    // 메뉴 화면 부드럽게 나타나기
    setTimeout(() => {
        document.getElementById('overlay-page').classList.add('visible');
    }, 10);
}
    
/* 화면J 닫기 및 이전 화면(I)으로 돌아가기 */
function closeScreenJ() {
    // 1. 화면 J 숨기기
    document.getElementById('screen-j').style.display = 'none';
    
    // 2. 화면 I 다시 보이기 (이게 리스트 화면)
    document.getElementById('screen-i').style.display = 'block';
    
    // 3. (중요) 화면 J 애니메이션 멈추기 (렉 방지)
    if (typeof jAnimId !== 'undefined') {
        cancelAnimationFrame(jAnimId);
    }
}
/* ESC 처리 */
document.addEventListener('keydown', e => {
    if(e.key === 'Escape'){

        if($('#eight-modal').style.display === 'flex') {
            closeEightModal();
        }
        else if($('#warning-modal').style.display === 'block'){
            closeWarning();
        }
        else if($('#screen-j').style.display === 'block'){ 
            closeScreenJ(); 
        }
        else if($('#screen-h').style.display === 'block'){
            goToHome();
        }
        else if($('#screen-f').classList.contains('visible')){
            $('#screen-f').onclick();
        }
        else if($('#screen-g').style.display === 'block'){
            closeBag();
        }
        else if($('#screen-i').style.display === 'block'){ 
            closeScreenI(); 
        }
        else if($('#screen-e').style.display === 'block'){
            $('#screen-e').onclick();
        }
        else if($('#screen-d').style.display === 'block'){
            $('#screen-d').style.display = 'none';
            $('#screen-c').style.display = 'block'; // D -> C는 MINE으로 돌아가고 싶으면 여기
            // 또는 바로 메뉴로 가고 싶으면 overlay-page 보이게
            $('#screen-c').style.display = 'none'; // C도 닫고
            $('#overlay-page').style.display = 'block'; // 메뉴로
        }
        else if($('#screen-c').style.display === 'block'){
            $('#screen-c').style.display = 'none';
            $('#overlay-page').style.display = 'block';
        }
        else if($('#overlay-page').classList.contains('visible')){
            $('#overlay-page').classList.remove('visible');

            setTimeout(()=>{
                $('#overlay-page').style.display = 'none';
                $('#main-content').style.display = 'block';
                document.body.style.overflow = 'hidden';
                start();
                firstVisit = true; 
            },600);
        }
    }
});
</script>
</body>
</html>

